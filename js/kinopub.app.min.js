function isInt(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))}function unix2date(e){var t=new Date(1e3*e),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=t.getFullYear(),n=a[t.getMonth()],r=t.getDate(),o=t.getHours(),s=t.getMinutes(),d=t.getSeconds(),c=r+" "+n+" "+i+" "+o+":"+s+":"+d;return c}var kp={dev:!0,version:.1,appPath:"./kinopub-app/",_init:function(){return this.modules._init(this),this}};kp.boot={_parent:!1,_init:function(e){return this._parent=e,this._parent.data.storage.device.name||this._parent.data.store("device",{name:void 0===window.tizen?this._parent.lang.get("device_default_webapp_name"):this._parent.lang.get("device_default_tizenapp_name")}),this._parent.auth.isAuthorized()&&this._parent.auth.checkAccessToken()?(this._parent.api.notify(),this._parent.modules.transferControl("boot",!1),this._parent.ui.deviceActivated()):this._parent.ui.deviceActivation(),this}},$(document).ready(function(){kp._init()}),kp.lang={_parent:!1,_init:function(e){return this._parent=this,this},locale:"ru",get:function(e){return"undefined"==typeof kp.lang[this.locale]?(this._parent.log.add("Lang > String > Locale "+this.locale+" не найдена"),"!"+e):"undefined"==typeof kp.lang[this.locale][e]?(this._parent.add("Lang > String > Определение "+e+" не найдено в локали "+this.locale),"?"+e):kp.lang[this.locale][e]}},kp.log={_init:function(e){return this._parent=e,this.add("Log > _init > Модуль Log загружен"),this},_parent:!1,data:{},storage:[],date:!1,add:function(e){this.date=new Date;var t=this.date.getHours()+":"+this.date.getHours()+":"+this.date.getSeconds()+"."+this.date.getMilliseconds();this.data[t]=e,this.storage.push(t+" > "+e),this._parent.dev&&console.log(t+" > "+e),jQuery(".kp-app-logs").length||jQuery("head").append('<div class="kp-app-logs hidden"></div>'),jQuery(".kp-app-logs").append("<p>"+e+"</p>")}},kp.data={boot:{device:["name","code","expires_in","expiry_interval","interval","user_code","verification_uri"],token:["access_token","expires_in","expiry_interval","refresh_token"],user:["profile_avatar","profile_name","reg_date","reg_unix","subscription_active","subscription_days","subscription_end_unix","subscription_end_date","username"],history:["unwatched"]},_parent:!1,storage:{},_init:function(e){this._parent=e;for(type in this.boot){var t=this.boot[type];this.restore(type,t)}return this},restore:function(e,t,a){"undefined"==typeof a&&(a="kp_"),"undefined"==typeof this.storage[e]&&(this.storage[e]={});for(i in t){var n=t[i];"undefined"==typeof this.storage[e][n]&&(this.storage[e][n]=null),""!=Cookies.get(a+e+"_"+n)&&(value=Cookies.get(a+e+"_"+n)),null==value||0==value?this._parent.log.add("Data > Restore > Игнорируем значение ["+e+"/"+n+"]"):(this._parent.log.add("Data > Restore > ["+e+"/"+n+"] => "+value),this.storage[e][n]=value)}},store:function(e,t,a){"undefined"==typeof a&&(a="kp_");for(name in t){var i=t[name];Cookies.set(a+e+"_"+name,i,{expires:180}),this.storage[e][name]=i}},remove:function(e,t,a){"undefined"==typeof a&&(a="kp_");for(i in t){var n=t[i];Cookies.remove(a+e+"_"+n),this.storage[e][n]=null}},wipe:function(){return!1}},kp.device={width:!1,height:!1,_parent:!1,_init:function(e){return this._parent=e,this.width=this.getWidth(),this.height=this.getHeight(),this},getWidth:function(){return jQuery(document).width()},getHeight:function(){return jQuery(document).height()},widthPercent:function(e){return Math.round(this.width*(.01*e))},heightPercent:function(e){return Math.round(this.height*(.01*e))},keys:{N1:49,N2:50,N3:51,N4:52,N5:53,N6:54,N7:55,N8:56,N9:57,N0:48,PRECH:10190,VOL_UP:448,VOL_DOWN:447,MUTE:449,CH_UP:427,CH_DOWN:428,TOOLS:10135,ENTER:13,RETURN:10009,INFO:457,EXIT:10182,UP:38,DOWN:40,LEFT:37,RIGHT:39,RED:403,GREEN:404,YELLOW:405,BLUE:406,RW:412,PAUSE:19,FF:417,REC:416,PLAY:415,STOP:413,PLAYPAUSE:10252},defaultControls:function(){},keyHandlers:{},eventHandled:{},registerKey:function(e,t){if(jQuery.isArray(e))for(i in e){var a=e[i];this.registerKey(a,t)}else{if(!isInt(e)&&"undefined"==typeof this.keys[e])return void this._parent.log.add("Device > registerKey > Код не найден ["+e+"]");isInt(e)||(e=this.keys[e]),this.keyHandlers[e]=t}},registerEvent:function(e,t,a){var i=this;"undefined"==typeof i.eventHandled[e]&&(i.eventHandled[e]={}),i.eventHandled[e][t]=a,jQuery(document).on(t,e,i.eventHandled[e][t])},setListeners:function(){var e=this;jQuery(document).on("keyup",function(t){"undefined"!=typeof e.keyHandlers[t.which]&&(e._parent.log.add("Device > Кнопка #"+t.which),e.keyHandlers[t.which]())})}},kp.api={_parent:!1,_init:function(e){return this._parent=e,this},auth:{host:"https://api.service-kp.com/oauth2/device",refreshHost:"https://api.service-kp.com/oauth2/token",client:{interval:!1,id:"xbmc",secret:"cgg3gtifu46urtfp2zp1nqtba0k2ezxh"}},apiHostUrl:"https://api.service-kp.com/v1/",refreshTokenUrl:"https://api.service-kp.com/oauth2/token",getDeviceCode:function(){var e=this;jQuery.ajax({method:"POST",url:e.auth.host,data:{grant_type:"device_code",client_id:e.auth.client.id,client_secret:e.auth.client.secret}}).done(function(t){e._parent.log.add("Api > getDeviceCode > Код устройства получен ("+t.code+")"),t.expiry_interval=t.expires_in,t.expires_in=jQuery.now()/1e3+t.expires_in,e._parent.data.store("device",t),e._parent.auth.showDeviceCode()}).fail(function(t,a,i){e._parent.log.add("Api > getDeviceCode > Ошибочка! "+a)})},checkDeviceCode:function(){var e=this;jQuery.ajax({method:"POST",url:e.auth.host,data:{grant_type:"device_token",client_id:e.auth.client.id,client_secret:e.auth.client.secret,code:e._parent.data.storage.device.code}}).done(function(t){t.expiry_interval=t.expires_in,t.expires_in=jQuery.now()/1e3+t.expires_in,e._parent.data.store("token",t),e._parent.log.add("Auth > deviceCodeCheck > Успешно получили access_token, подметаем половичок"),e._parent.auth.cleanUpAfterGettingDeviceCode()}).fail(function(t,a,i){"authorization_pending"!=t.responseJSON.error&&(e._parent.log.add(t.responseJSON.error),e._parent.log.add(t.responseJSON.error_description))})},notify:function(){var e=this;jQuery.ajax({method:"POST",url:e.apiHostUrl+"device/notify?access_token="+e._parent.data.storage.token.access_token,data:{title:void 0===window.tizen?e._parent.lang.get("device_default_webapp_name")+" @ "+window.location:e._parent.data.storage.device.name?e._parent.data.storage.device.name:e._parent.lang.get("device_default_tizenapp_name"),hardware:void 0===window.tizen?e._parent.lang.get("device_default_webapp_detailed_name")+" v. "+e._parent.version:"OS v."+webapis.tvinfo.getVersion(),software:void 0===window.tizen?e._parent.lang.get("device_default_webapp_name"):"KinoPub v."+tizen.application.getAppInfo().version}}).done(function(e){}).fail(function(t,a,i){401!=t.responseJSON.status?(e._parent.log.add(t.responseJSON.error),e._parent.log.add(t.responseJSON.error_description)):e.updateAccessToken()})},updateAccessToken:function(){var e=this;e._parent.log.add("API > updateAccessToken > Запрашиваем новый access token"),jQuery.ajax({method:"POST",url:e.refreshTokenUrl,data:{grant_type:"refresh_token",client_id:e.auth.client.id,client_secret:e.auth.client.secret,refresh_token:e._parent.data.storage.token.refresh_token}}).done(function(t){e._parent.log.add("API > updateAccessToken > Access_token обновлен"),t.expiry_interval=t.expires_in,t.expires_in=jQuery.now()+t.expires_in,e._parent.data.store("token",t)}).fail(function(t,a,i){401!=t.responseJSON.status&&(e._parent.log.add("API > updateAccessToken > Ошибочка! "+a),"authorization_expired"==t.responseJSON.error&&e._parent.data.wipe(),e._parent.log.add(t.responseJSON.error),e._parent.log.add(t.responseJSON.error_description)),e._parent.ui.deviceActivation()})},getUser:function(){var e=this;e._parent.log.add("API > getUser > Получаем данные пользователя"),jQuery.ajax({method:"GET",url:e.apiHostUrl+"user?access_token="+e._parent.data.storage.token.access_token}).done(function(t){return 200!=t.status?void e._parent.log.add("API > getUser > Status Error "+t.status):(t=t.user,e._parent.data.store("user",{profile_avatar:t.profile.avatar,profile_name:t.profile.name,reg_date:unix2date(t.reg_date),reg_unix:t.reg_date,subscription_active:t.subscription.active,subscription_days:t.subscription.days,subscription_end_date:unix2date(t.subscription.end_time),subscription_end_unix:t.subscription.end_time,username:t.username}),void e._parent.data.store("history",{unwatched:{total:0,items:{}}}))}).fail(function(t,a,i){e._parent.log.add("API > getUser > Ошибочка! "+a)})},getUnwatched:function(e){var t=this;t.getUnwatchedSerials(e)},getUnwatchedFilms:function(e){var t=this;t._parent.log.add("API > getUnwatched > Films > Получаем фильмы к просмотру"),jQuery.ajax({method:"GET",url:t.apiHostUrl+"watching/movies?access_token="+t._parent.data.storage.token.access_token}).done(function(e){return 200!=e.status?void t._parent.log.add("API > getUser > Status Error "+e.status):void t._parent.user.processUnwatched(e.items,"films")}).fail(function(e,a,i){t._parent.log.add("API > getUnwatched > Ошибочка! "+a)})},getUnwatchedSerials:function(e){var t=this;this._parent.log.add("API > getUnwatched > Serials > Получаем сериалы к просмотру"),jQuery.ajax({method:"GET",url:t.apiHostUrl+"watching/serials?access_token="+t._parent.data.storage.token.access_token}).done(function(a){return 200!=a.status?void t._parent.log.add("API > getUser > Status Error "+a.status):(kp.user.processUnwatched(a.items,"serials"),void e())}).fail(function(e,a,i){t._parent.log.add("API > getUnwatched > Ошибочка! "+a)})},getTypes:function(){var e=this;jQuery.ajax({method:"GET",url:e.apiHostUrl+"types?access_token="+e._parent.data.storage.token.access_token}).done(function(t){return 200!=t.status?void e._parent.log.add("API > getUser > Status Error "+t.status):void e._parent.config.updateTypes(t.items)}).fail(function(t,a,i){e._parent.log.add("API > getUnwatched > Ошибочка! "+a)})}},kp.user={_parent:!1,_init:function(e){return this._parent=e,this},getUser:function(){this._parent.api.getUser()},getUserNav:function(){var e=[];for(i in this._parent.config.menues.my){var t=this._parent.config.menues.my[i];t.title=this._parent.lang.get(t.lang),e.push(t)}return e},getUserCategories:function(){var e=[],t=this._parent.config.menues.categories;for(i in t){var a=t[i];0!=a.lang&&(a.title=this._parent.lang.get(a.lang)),e.push(a)}return e},processUnwatched:function(e,t){switch(t){case"films":break;case"serials":var a=0;this._parent.data.storage.history.unwatched.serials={};for(i in e){var n=e[i];a+=n["new"],10,this._parent.data.storage.history.unwatched.serials[n.id]=n}this._parent.data.storage.history.unwatched.total=a;break;default:this._parent.log.add("User > processUnwatched > Тип данных не найден > "+t)}this._parent.ui.updateUnwatched()}},kp.ui={_duration:10,_parent:!1,_init:function(e){return this._parent=e,this._welcome()},_welcome:function(){var e=this;return e._reset(),jQuery("body").addClass("kp-welcome").html('<div class="kp-logo"><h2>kino<span>pub</span></h2></div>'),jQuery(".kp-logo").animate({opacity:1},15*e._duration).promise().then(function(){e._parent.auth.checkAccessToken()||jQuery(".kp-logo").animate({marginTop:"-10%"},10*e._duration).promise().then(function(){jQuery('<div class="kp-status"></div>').insertAfter(".kp-logo"),e.setLoader(jQuery(".kp-status"))})}),e},_reset:function(){jQuery("body").html("")},setLoader:function(e){e.html('<i class="kp-loader fa fa-beer faa-wrench animated kp-loader" aria-hidden="true"></i>')},removeLoader:function(e){e.remove()},removeLoaders:function(){var e=this;jQuery(".kp-loader").each(function(t,a){e.removeLoader(jQuery(a))})},deviceActivation:function(){var e=this;return this._parent.log.add("UI > Интерфейс активации"),jQuery("#kp-device-activation").length?!1:(this.removeLoaders(),this._parent.modules.transferControl("ui","activation"),jQuery("body").addClass("kp-blurred"),jQuery("body").append('<div id="kp-device-activation"><div class="kp-device-activation-container"><h3>'+this._parent.lang.get("device_activation_header")+'</h3><div class="kp-device-activation-code"></div></div></div>'),jQuery("#kp-device-activation").css({width:e._parent.device.width+"px",height:e._parent.device.height+"px"}),this.setLoader(jQuery("#kp-device-activation .kp-device-activation-code")),void this._parent.auth.getDeviceCode())},deviceActivated:function(){var e=this;e._parent.log.add("UI > Скрываем интерфейс активации"),jQuery("body").removeClass("kp-blurred"),jQuery("#kp-device-activation").remove();var e=this;1==jQuery("body").hasClass("kp-welcome")&&jQuery(".kp-welcome .kp-logo").animate({marginTop:"0%"},10*e._duration).promise().then(function(){jQuery(".kp-logo").animate({opacity:0}).promise().then(function(){e._parent.user.getUser(),jQuery(".kp-logo").remove(),jQuery("body").animate({backgroundColor:"#2f373e"},7*e._duration).promise().then(function(){jQuery("body").removeClass("kp-welcome"),jQuery(".kp-logo, .kp-status").remove(),e.drawLayout(),e._parent.modules.transferControl("ui","homepage")})})})},load:function(e,t){var a=this;jQuery.ajax({method:"GET",url:a._parent.appPath+e+".html"}).done(function(e){t(e)}).fail(function(t,i,n){a._parent.log.add("UI > Load > "+e+" (->"+target+") >  Ошибочка! "+i)})},drawLayout:function(){var e=this;jQuery(".kp-header").length||e.load("ui/_header",function(t){jQuery("body").html(t),e._parent.search._init(e._parent),e._parent.ui.updateUserinfo();var a=e._parent.user.getUserNav();for(keyword in a){var i=a[keyword];jQuery(".kp-header .kp-my-categories ul").append(e.menuItem(i))}e.drawMainNav(),e.getUnwatched(function(){e._parent.modules.transferControl("grid","homepage")})})},drawMainNav:function(){var e=this,t=e._parent.user.getUserCategories();jQuery(".kp-header .kp-main-categories ul > *").remove();for(keyword in t){var a=t[keyword];jQuery(".kp-header .kp-main-categories ul").append(e.menuItem(a))}},menuItem:function(e){var t="";for(i in e)t=t+"data-kp-"+i+'="'+e[i]+'" ';return"<li "+t+'><a href="#">'+e.title+"</a></li>"},getUnwatched:function(e){this._parent.api.getUnwatched(e)},updateUnwatched:function(){this._parent.data.storage.history.unwatched.total>0?(jQuery(".kp-my-categories ul li[data-kp-keyword='my_watched']").addClass("kp-notify"),jQuery(".kp-my-categories ul li.kp-notify .kp-my-notifications").length?jQuery(".kp-my-categories ul li.kp-notify .kp-my-notifications").html(this._parent.data.storage.history.unwatched.total):jQuery(".kp-my-categories ul li.kp-notify a").append('<span class="kp-my-notifications">'+this._parent.data.storage.history.unwatched.total+"</span>")):(jQuery(".kp-top-bar .kp-my-categories ul li.kp-notify .kp-my-notification").remove(),jQuery(".kp-top-bar .kp-my-categories ul li.kp-notify").removeClass("kp-notify"))},updateUserinfo:function(){jQuery(".kp-userinfo .kp-userpic").prop("src",this._parent.data.storage.user.profile_avatar),jQuery(".kp-userinfo .kp-username").html(this._parent.data.storage.user.username),jQuery(".kp-userinfo .kp-user-pro-duration").text(Math.round(this._parent.data.storage.user.subscription_days)),this._parent.log.add("UI > updateUserinfo > Обновлен UI")},onGetControl:function(e){var t=this;switch(e){case"activation":t._parent.device.registerKey(["ENTER"],function(){t._parent.api.getDeviceCode()}),t._parent.device.registerEvent("#kp-device-activation .kp-device-activation-code h1","dblclick",function(){t._parent.api.getDeviceCode()});break;case"homepage":break;case"grid":break;default:t._parent.log.add("UI > onGetControl > Неизвестный тип ["+e+"]")}}},kp.auth={_parent:!1,_init:function(e){return this._parent=e,this},isAuthorized:function(){return this.hasAccessToken()},getDeviceCode:function(){this.hasDeviceCode()?(this._parent.log.add("Auth > getDeviceCode > Device код уже есть"),this.showDeviceCode()):(this._parent.data.wipe(),this._parent.log.add("Auth > getDeviceCode > Получаем новый device код"),this._parent.api.getDeviceCode())},showDeviceCode:function(){var e=kp.data.storage.device;jQuery("#kp-device-activation .kp-device-activation-code").html("<h1>"+e.user_code+'</h1><div class="kp-device-activation-bar"></div><span>'+this._parent.lang.get("device_activation_description")+"<strong>"+e.verification_uri+"</strong></span>"),this._parent.log.add("Auth > showDeviceCode > Отобразили код, запускаем таймеры"),this.deviceCodeBar(),this.deviceCodeCheck()},deviceCodeCheck:function(){var e=this;return("undefined"==typeof this._parent.data.storage.device.intervalCodeChecks||0==this._parent.data.storage.device.intervalCodeChecks)&&(this._parent.data.storage.device.intervalCodeChecks=setInterval(function(){e.deviceCodeCheck()},1e3*this._parent.data.storage.device.interval)),0==this.hasDeviceCode()?(this._parent.log.add("Auth > deviceCodeCheck > Код протух, пора брать новый"),this.getDeviceCode(),!1):void this._parent.api.checkDeviceCode()},cleanUpAfterGettingDeviceCode:function(){this._parent.log.add("Auth > CleanUp > Удаляем временные данные"),clearInterval(this._parent.data.storage.device.intervalCodeChecks),clearInterval(this._parent.data.storage.device.intervalProgressBar);var e=[];for(i in this._parent.data.storage.device){this._parent.data.storage.device[i];"name"!=i&&e.push(i)}this._parent.data.remove("device",e),this._parent.ui.deviceActivated(),this._parent.api.notify()},deviceCodeBar:function(){var e=this;("undefined"==typeof this._parent.data.storage.device.intervalProgressBar||0==this._parent.data.storage.device.intervalProgressBar)&&(this._parent.data.storage.device.intervalProgressBar=setInterval(function(){e.deviceCodeBar()},300)),jQuery("#kp-device-activation .kp-device-activation-code .kp-device-activation-bar .progress-bar").length||jQuery("#kp-device-activation .kp-device-activation-code .kp-device-activation-bar").html('<div class="progress"><div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax=""></div></div>');var t=jQuery("#kp-device-activation .kp-device-activation-code .kp-device-activation-bar .progress-bar"),a=(this.deviceCodeExpiresIn()/this._parent.data.storage.device.expiry_interval*100).toFixed(2);t.css({width:a+"%"}),50>a&&t.removeClass("progress-bar-success progress-bar-danger").addClass("progress-bar-warning"),10>a&&t.removeClass("progress-bar-success progress-bar-warning").addClass("progress-bar-danger"),a>=50&&t.removeClass("progress-bar-danger progress-bar-warning").addClass("progress-bar-success")},hasDeviceCode:function(){return"undefined"!=typeof this._parent.data.storage.device.code&&this._parent.data.storage.device.code?jQuery.now()/1e3>this._parent.data.storage.device.expire_in||this.deviceCodeExpiresIn()<=0?!1:(this._parent.log.add("Auth > hasDeviceCode > Через "+this.deviceCodeExpiresIn()+" секунд девайс токен умрет"),!0):!1},deviceCodeExpiresIn:function(){return parseInt(this._parent.data.storage.device.expires_in,10)-parseInt(jQuery.now()/1e3,10)},checkAccessToken:function(){return this._parent.log.add("Auth > checkAccessToken > "+this.accessTokenExpiresIn()),this.hasAccessToken()?!0:("undefined"!=typeof this._parent.data.storage.token.access_token&&null!=this._parent.data.storage.token.access_token&&this._parent.api.updateAccessToken(),!1)},hasAccessToken:function(){return"undefined"!=typeof this._parent.data.storage.token.access_token&&this._parent.data.storage.token.access_token?((jQuery.now()/1e3>this._parent.data.storage.token.expires_in||this.accessTokenExpiresIn()<=0)&&this._parent.api.updateAccessToken(),!0):!1},accessTokenExpiresIn:function(){return"undefined"==typeof this._parent.data.storage.token||"undefined"==typeof this._parent.data.storage.token.expires_in||null==this._parent.data.storage.token.expires_in?0:parseInt(this._parent.data.storage.token.expires_in,10)-parseInt(jQuery.now()/1e3,10)}},kp.config={_parent:!1,_init:function(e){return this._parent=e,this},grid:{visibleItems:8,titleLen:20},menues:{my:[{module:"grid",method:"watched",lang:"nav_my_i_watch",keyword:"my_watched"},{module:"bookmarks",method:"index",lang:"nav_my_bookmarks"},{module:"playlists",method:"index",lang:"nav_my_playlists"}],categories:[{module:"grid",method:"movie",lang:"nav_categories_movie"},{module:"grid",method:"serial",lang:"nav_categories_serial"},{module:"grid",method:"tvshow",lang:"nav_categories_tvshow"},{module:"grid",method:"ddd",lang:"nav_categories_3d"},{module:"grid",method:"kkkk",lang:"nav_categories_4k"},{module:"grid",method:"concert",lang:"nav_categories_concert"},{module:"grid",method:"documovie",lang:"nav_categories_documovie"},{module:"grid",method:"docuserial",lang:"nav_categories_docuserial"},{module:"grid",method:"picked",lang:"nav_categories_picked"}]},updateTypes:function(e){var t=[];for(i in e){var a=e[i],n={module:"grid",method:a.id,lang:!1,title:a.title};t.push(n)}t.push({module:"grid",method:"picked",lang:"nav_categories_picked"}),this.menues.categories=t}},kp.modules={onBoot:["log","lang","data","device","api","ui","auth","user","search","grid","boot","cache"],controlledBy:!1,_parent:!1,_init:function(e){this._parent=e;for(moduleID in this.onBoot)this.load(this.onBoot[moduleID])},load:function(e){return"undefined"!=typeof this._parent.log.add&&this._parent.log.add("Modules > _init > Загрузка модуля "+e),"undefined"==typeof kp[e]?void this._parent.log.add("Modules > _init > Модуль не загружен "):(this._parent[e]=kp[e]._init(this._parent),void("undefined"!=typeof this._parent.log.add&&this._parent.log.add("Modules > _init > Модуль "+e+" загружен")))},transferControl:function(e,t){this._parent.log.add("Modules > Управление передано от "+this.controlledBy+" к "+e+"["+t+"]"),0!=this.controlledBy&&"undefined"!=typeof this._parent[this.controlledBy].onLostControl&&this._parent[this.controlledBy].onLostControl(),jQuery(document).off(),this._parent.device.keyHandlers={},this._parent.device.eventHandled={},this._parent.device.defaultControls(),this.controlledBy=e,0!=this.controlledBy&&"undefined"!=typeof this._parent[e].onGetControl&&this._parent[this.controlledBy].onGetControl("undefined"!=typeof t?t:!1),this._parent.device.setListeners()}},kp.search={_parent:!1,_init:function(e){this._parent=e;var t=this;return jQuery(".kp-top-bar .kp-top-searchbar .kp-searchbox").data("placeholder",t._parent.lang.get("search_placeholder")).val(t._parent.lang.get("search_placeholder")),jQuery(".kp-top-bar").on("focus",".kp-top-searchbar .kp-searchbox",function(){var e=jQuery(this);e.closest(".kp-top-searchbar").addClass("active"),e.val()==e.data("placeholder")&&e.val("")}),jQuery(".kp-top-bar").on("blur",".kp-top-searchbar .kp-searchbox",function(){var e=jQuery(this);e.closest(".kp-top-searchbar").removeClass("active"),0==jQuery.trim(e.val()).length&&e.val(e.data("placeholder"))}),this}},kp.grid={_parent:!1,grid:!1,_init:function(e){return this._parent=e,this},_setContainerLoader:function(){jQuery(".kp-container").html('<div class="kp-loader"><i class="fa fa-cog faa-spin animated vcenter centered"></i></div>'),jQuery(".kp-container .kp-loader").css({width:jQuery(".kp-container").outerWidth(!0)+"px",height:jQuery(".kp-container").outerHeight(!0)+"px"})},_buildGrid:function(e){var t=this;"string"!=typeof e?t._parent.log.add("Grid > _buildGrid > Шаблон не строка"):t.grid=jQuery(e)},_showGrid:function(){var e=this;jQuery(".kp-container").html(e.grid)},addRow:function(e,t){var a=this;"undefined"!=typeof t&&a.grid.append('<div class="kp-grid-row kp-grid-row-title"><h2>'+t+"</h2></div>"),a.grid.append('<div class="kp-grid-row" data-width="0" data-height="0" data-loaded="0"><div class="kp-grid-row-container">'+a.addItems(e)+"</div></div>"),a.grid.find(".kp-grid-row:last .kp-grid-item-poster").on("load",function(){jQuery(this).addClass("kp-grid-item-poster-loaded"),a.normalizeRow(jQuery(this))})},addItems:function(e){var t="",a=this;for(i in e)t+=a.addItem(e[i]);return t},addItem:function(e){var t=this;return['<div class="kp-grid-item">','<a href="#">','<img class="kp-grid-item-poster" src="'+t._getImageSrc(e)+'">','<div class="kp-grid-item-title">'+t.shortTitle(e.title)+"</div>","undefined"!=typeof e.notification?'<div class="kp-grid-item-notify">'+e.notification+"</div>":"","</a>","</div>"].join("")},normalizeRow:function(e){return},_setGridHandlers:function(e){},shortTitle:function(e){var t=this;return e.indexOf(" / ")&&(e=e.split(" / ")[0]),e.length>t._parent.config.grid.titleLen?e.substr(0,t._parent.config.grid.titleLen-3)+"&hellip;":e},_getImageSrc:function(e){return e.poster.replace("https://","http://")},onGetControl:function(e){var t=this;switch(e){case"homepage":this._setContainerLoader(),t._parent.ui.load("ui/grid",function(e){t._buildGrid(e),t.addRow(t._extractUnwatched(t._parent.data.storage.history.unwatched.serials),"Сериалы"),t._showGrid()});break;default:this._parent.log.add("Grid > "+e)}},_extractUnwatched:function(e){var t=[];for(i in e){var a=e[i];t.push({title:a.title,id:a.id,type:a.type,subtype:a.subtype,poster:a.posters.big,notification:a["new"]})}return t}},kp.cache={_parent:!1,_init:function(e){return this._parent=e,this},get:function(e){var t=this;return t._parent.log.add("Cache > Get ["+e+"]"),localStorage.getItem(e)},set:function(e,t){var a=this;return a._parent.log.add("Cache > Set ["+e+"] \n "+t),localStorage.setItem(e,t)},remove:function(e){var t=this;t._parent.log.add("Cache > Remove ["+e+"]"),localStorage.removeItem(e)},wipe:function(){var e=this;e._parent.log.add("Cache > Wipe!"),localStorage.clear()},cacheImage:function(e,t){var a=this;a._parent.log.add("Cache > Image ["+t+" @ "+e+" ]"),a._toBase64(e,function(e){a.set(t,e)})},_toBase64:function(e,t){var a=new XMLHttpRequest;a.open("GET",e),a.Origin="https://kino.pub",a.responseType="blob",a.send(),a.addEventListener("load",function(){var e=new FileReader;e.readAsDataURL(a.response),e.addEventListener("loadend",function(){console.log(e.result)})})}},kp.lang.ru={device_default_webapp_name:"WebApp",device_default_webapp_detailed_name:"WebApp by ctepeo",device_default_tizenapp_name:"Мой TizenTV",device_activation_header:"Активация устройства",device_activation_description:"Введите указанный код на сайте",search_placeholder:"Поиск",nav_my_i_watch:"Я смотрю",nav_my_bookmarks:"Закладки",nav_my_playlists:"Плейлисты",nav_categories_movie:"Фильмы",nav_categories_serial:"Сериалы",nav_categories_tvshow:"ТВ Шоу",nav_categories_3d:"3D",nav_categories_4k:"4K",nav_categories_concert:"Концерты",nav_categories_documovie:"Докуфильмы",nav_categories_docuserial:"Докусериалы",nav_categories_picked:"Подборки"};